<!doctype html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <title>贷款计算器</title>
        <style>
            /* 简单样式 */
            body {
                font-family: Arial, sans-serif;
            }
            .container {
                margin: 20px;
            }
            .loan-type-list,
            .my-loans {
                margin-bottom: 20px;
            }
            .loan-detail {
                display: none;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>贷款类型库</h1>
            <div class="loan-type-list" id="loanTypeList"></div>
            <button onclick="addLoanType()">添加贷款类型</button>

            <h1>我的贷款</h1>
            <div class="my-loans" id="myLoans"></div>
            <button onclick="addMyLoan()">添加贷款</button>
        </div>

        <script>
            let loanTypes = [];
            let myLoans = [];

            function addLoanType() {
                const name = prompt("请输入贷款类型名称");
                const rate = parseFloat(prompt("请输入年利率"));
                const startDate = prompt("请输入开始还款日期 (格式 YYYY-MM)");
                const months = parseInt(prompt("请输入还款月数"), 10);
                const type = prompt("请选择还款方式 (等额本金/等额本息)");

                loanTypes.push({
                    name,
                    rate,
                    startDate,
                    months,
                    type,
                    ratesChanges: [],
                });
                renderLoanTypeList();
            }

            function renderLoanTypeList() {
                const listElement = document.getElementById("loanTypeList");
                listElement.innerHTML = "";
                loanTypes.forEach((loanType, index) => {
                    const div = document.createElement("div");
                    div.textContent = `${loanType.name} (${loanType.rate}% ${loanType.startDate} ${loanType.months}个月 ${loanType.type})`;
                    div.onclick = () => editLoanType(index);
                    listElement.appendChild(div);
                });
            }

            function editLoanType(index) {
                // 编辑贷款类型逻辑
            }

            function addMyLoan() {
                const totalAmount = parseFloat(
                    prompt("请输入总贷款金额 (单位万元)"),
                );
                const loanDetails = [];

                while (true) {
                    const selectedLoanTypeName =
                        prompt("选择贷款类型 (输入'完成'结束)");
                    if (selectedLoanTypeName === "完成") break;

                    const loanType = loanTypes.find(
                        (lt) => lt.name === selectedLoanTypeName,
                    );
                    if (!loanType) {
                        alert("未找到对应的贷款类型！");
                        continue;
                    }

                    const amount = parseFloat(
                        prompt(`请输入${loanType.name}的贷款金额`),
                    );
                    loanDetails.push({ loanType, amount });
                }

                if (
                    loanDetails.reduce(
                        (sum, detail) => sum + detail.amount,
                        0,
                    ) !== totalAmount
                ) {
                    alert("各贷款类型的金额总和必须等于总贷款金额！");
                    return;
                }

                myLoans.push({
                    totalAmount,
                    details: loanDetails,
                    schedule: calculateRepaymentSchedule(loanDetails),
                });

                renderMyLoans();
            }

            function calculateRepaymentSchedule(details) {
                // 这里应该是核心计算逻辑，现在只是一个示例
                let schedule = [];
                details.forEach((detail) => {
                    for (
                        let month = 1;
                        month <= detail.loanType.months;
                        month++
                    ) {
                        schedule.push({
                            month,
                            yearMonth: `${detail.loanType.startDate}-${month}`,
                            payment: (
                                (detail.amount * detail.loanType.rate) /
                                1200
                            ).toFixed(2),
                            principal: (
                                detail.amount / detail.loanType.months
                            ).toFixed(2),
                            interest: (
                                (detail.amount * detail.loanType.rate) / 1200 -
                                detail.amount / detail.loanType.months
                            ).toFixed(2),
                            remainingPrincipal: (
                                detail.amount -
                                (detail.amount / detail.loanType.months) * month
                            ).toFixed(2),
                        });
                    }
                });
                return schedule;
            }

            function renderMyLoans() {
                const listElement = document.getElementById("myLoans");
                listElement.innerHTML = "";
                myLoans.forEach((loan, index) => {
                    const div = document.createElement("div");
                    div.textContent = `总贷款金额：${loan.totalAmount}万元`;
                    div.onclick = () => showLoanDetail(index);
                    listElement.appendChild(div);
                });
            }

            function showLoanDetail(index) {
                const loan = myLoans[index];
                const detailDiv = document.querySelector(".loan-detail");
                detailDiv.innerHTML = `
        <h2>贷款详情</h2>
        <p>总贷款金额：${loan.totalAmount}万元</p>
        <table>
            <thead><tr><th>第几个月</th><th>具体年月</th><th>月还款额</th><th>还款本金</th><th>还款利息</th><th>剩余本金</th></tr></thead>
            <tbody>
                ${loan.schedule.map((item) => `<tr><td>${item.month}</td><td>${item.yearMonth}</td><td>${item.payment}</td><td>${item.principal}</td><td>${item.interest}</td><td>${item.remainingPrincipal}</td></tr>`).join("")}
            </tbody>
        </table>
    `;
                detailDiv.style.display = "block";
            }
        </script>
    </body>
</html>
